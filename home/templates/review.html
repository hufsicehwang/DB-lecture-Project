<!DOCTYPE html>
<html>
    <head>
        <title>Movie Note</title>
        <link rel="stylesheet" href="/static/assets/css/header.css">
        <link rel="stylesheet" href="/static/css/review.css?after?after">
        <script src="/static/js/includeHTML.js"></script>
        <style>
            html,body{
                margin: 0;
            }
        </style>
    </head>
    <body>
        <header include-html="/static/html/header.html?after"></header>
        <!-- <h3 class="review_h3">공개 설정</h3> -->
        <div class="form__group field">
            <form action="" method="post">
                {% csrf_token %}
                <div class="searchBox" style="display:flex; 
                align-items: center;">

                    <input type="input" class="form__field" placeholder="제목" name="name" id='name' required />
                    <div class="button-17" onclick="onClickSearch()">검색</div>
                    <label for="name" class="form__label">영화 검색</label>
                </div>
                <div class="sub-text" style="color: gray;

                font-size: 12px;
                margin-top:1rem;
                text-align: center;">영화 제목이 검색이 되지 않으면 부분적인 단어의 형태로 검색해 주세요. </div>
                <div class="contents">
                    <div class="contents_btn" id="public" onclick="onClick1()">
                        <svg width="24" height="24" fill="none" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm-1.243 22.212a10.209 10.209 0 0 1-6.03-2.939A10.218 10.218 0 0 1 1.714 12c0-2.473.868-4.813 2.458-6.673.041.492.142 1.019.116 1.395-.094 1.373-.23 2.232.574 3.39.313.451.39 1.098.542 1.62.149.51.744.779 1.155 1.094.828.635 1.62 1.373 2.5 1.932.579.369.941.552.771 1.26-.136.569-.174.92-.469 1.426-.09.155.34 1.15.482 1.292.433.433.862.83 1.333 1.219.732.604-.07 1.389-.42 2.257zm8.516-2.939a10.213 10.213 0 0 1-5.34 2.832c.285-.705.793-1.331 1.264-1.694.409-.316.922-.924 1.136-1.405.213-.48.496-.898.783-1.34.407-.628-1.005-1.577-1.463-1.776-1.03-.447-1.805-1.05-2.72-1.694-.653-.46-1.977.24-2.713-.082-1.009-.44-1.84-1.206-2.716-1.866-.905-.68-.861-1.475-.861-2.48.708.026 1.716-.196 2.187.373.148.18.659.984 1 .698.28-.233-.207-1.168-.3-1.388-.29-.676.658-.94 1.142-1.398.632-.597 1.989-1.535 1.882-1.964-.108-.428-1.358-1.643-2.092-1.453-.11.028-1.078 1.044-1.266 1.203l.015-.994c.004-.21-.39-.424-.372-.56.046-.34.996-.96 1.232-1.232-.165-.103-.73-.588-.9-.517-.415.173-.882.291-1.296.464 0-.144-.017-.279-.038-.412a10.188 10.188 0 0 1 2.614-.758l.812.326.574.68.573.591.5.162.795-.75-.205-.535v-.481c1.572.228 3.057.814 4.357 1.719-.233.02-.488.055-.777.091-.119-.07-.272-.102-.401-.15.376.81.77 1.608 1.169 2.408.426.853 1.372 1.77 1.539 2.67.195 1.063.06 2.028.166 3.278.104 1.204 1.358 2.572 1.358 2.572s.579.197 1.06.128a10.222 10.222 0 0 1-2.698 4.734z">
        
                            </path>
                        </svg>
                        <div class="description">전체 공개</div>
                    </div>
                    <div class="contents_btn" id="secure" onclick="onClick2()">
                        <svg width="24" height="24" fill="none" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M17.625 9H16.5V6.81c0-2.47-1.969-4.522-4.44-4.56a4.514 4.514 0 0 0-4.56 4.5V9H6.375A1.88 1.88 0 0 0 4.5 10.875v9a1.88 1.88 0 0 0 1.875 1.875h11.25a1.88 1.88 0 0 0 1.875-1.875v-9A1.88 1.88 0 0 0 17.625 9zm-4.969 5.85v3.225a.672.672 0 0 1-.623.675.657.657 0 0 1-.69-.656V14.85a1.5 1.5 0 0 1-.838-1.486 1.5 1.5 0 1 1 2.152 1.486zM15.187 9H8.814V6.75c0-.848.332-1.645.937-2.25A3.16 3.16 0 0 1 12 3.562a3.16 3.16 0 0 1 2.25.938 3.16 3.16 0 0 1 .938 2.25V9z">
        
                            </path>
                        </svg>
                        <div class="description">비공개</div>
                    </div>
                    <input type="checkbox" value="open" name="open" id="open" style="visibility: hidden;">
                    <input type="checkbox" value="non-open" name="non-open" id="non-open"style="visibility: hidden;">
                </div>
                
                <div class="star-rating space-x-4 mx-auto">
                    <input type="radio" id="5-stars" name="rating" value="5" v-model="ratings"/>
                    <label for="5-stars" class="star pr-4">★</label>
                    <input type="radio" id="4-stars" name="rating" value="4" v-model="ratings"/>
                    <label for="4-stars" class="star">★</label>
                    <input type="radio" id="3-stars" name="rating" value="3" v-model="ratings"/>
                    <label for="3-stars" class="star">★</label>
                    <input type="radio" id="2-stars" name="rating" value="2" v-model="ratings"/>
                    <label for="2-stars" class="star">★</label>
                    <input type="radio" id="1-star" name="rating" value="1" v-model="ratings" />
                    <label for="1-star" class="star">★</label>
                </div>
                
               
                <textarea class="form-control" name="message" id="message" cols="30" rows="7" placeholder="리뷰를 작성해보세요" spellcheck="false"></textarea>
        </div>
                <div class="bottom_input">
                    <input type="button" value="내가 쓴 목록 보기" class="review_send_btn red" id="movielistcom">

                    <input type="submit" value="리뷰 작성" class="review_send_btn">
                </div>
            </form>
            <div id ="modal"class="details-modal" style="display: none;">
                <div class="details-modal-title">
                    <h1>My details modal</h1>
                    <div class="details-modal-close" onclick="onclickCloseModal()">
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none" style="cursor: pointer; z-index: 9999;">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M13.7071 1.70711C14.0976 1.31658 14.0976 0.683417 13.7071 0.292893C13.3166 -0.0976311 12.6834 -0.0976311 12.2929 0.292893L7 5.58579L1.70711 0.292893C1.31658 -0.0976311 0.683417 -0.0976311 0.292893 0.292893C-0.0976311 0.683417 -0.0976311 1.31658 0.292893 1.70711L5.58579 7L0.292893 12.2929C-0.0976311 12.6834 -0.0976311 13.3166 0.292893 13.7071C0.683417 14.0976 1.31658 14.0976 1.70711 13.7071L7 8.41421L12.2929 13.7071C12.6834 14.0976 13.3166 14.0976 13.7071 13.7071C14.0976 13.3166 14.0976 12.6834 13.7071 12.2929L8.41421 7L13.7071 1.70711Z" fill="black" />
                      </svg>
                    </div>
                </div>
                <div id="detail_modal" class="details-modal-content">
                  
                </div>
              </div>
    </body>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script>
        includeHTML();
        document.addEventListener('keydown', function(event) {
            if (event.keyCode === 13) {
                event.preventDefault();
            };
            }, true);
        var checkMovieNm = false
        //기본값 true
        document.getElementById('open').checked = true;
        document.getElementById("public").style.border="1px solid rgb(32, 201, 151)"
        document.getElementById("public").style.color="rgb(32, 201, 151)"
        document.getElementById("secure").style.border="1px solid transparent"
        document.getElementById("secure").style.color="rgb(134, 142, 150)"
        function onClick1(){
            console.log("open")
            document.getElementById('open').checked = true;
            document.getElementById('non-open').checked = false;
            document.getElementById("public").style.border="1px solid rgb(32, 201, 151)"
            document.getElementById("public").style.color="rgb(32, 201, 151)"
            document.getElementById("secure").style.border="1px solid transparent"
            document.getElementById("secure").style.color="rgb(134, 142, 150)"
        }

        function onClick2(){
            document.getElementById('non-open').checked = true;
            document.getElementById('open').checked = false;
            document.getElementById("secure").style.border="1px solid rgb(32, 201, 151)"
            document.getElementById("secure").style.color="rgb(32, 201, 151)"
            document.getElementById("public").style.border="1px solid transparent"
            document.getElementById("public").style.color="rgb(134, 142, 150)"
        
        }
        var list = []
        function onClickSearch(){
            const url = "/home/search/";
            if(checkMovieNm) {

                $.ajax({                       
                    type: 'POST',
                    url: url,
                    data: { 'movieNm' : document.getElementById("name").value,
                    },
                    success: function (data){
                        if(data['exist']=="exist"){
                            alert("해당 영화의 리뷰가 존재 합니다. 다른 영화를 선택해 주세요.")
                        }
                        else{
    
                            list = data['id']
                            console.log(data['id'])
                            document.getElementById("modal").style.display="block"
                            // document.getElementById("modal_p").innerHTML=JSON.stringify(list)
                            var tagfield  = document.getElementById("detail_modal")
                            // genreAlt: "드라마"
                            // id: 66864
                            // movieCd: "0"
                            // movieNm: "빨간구두"
                            // nationAlt: ""
                            // prdtYear: "2004"
                            console.log(list.length)
                            for(i=0; i<list.length;i++){
                                var p = document.createElement("p")
                                p.innerHTML = `${list[i]["movieNm"]}, 장르 : ${list[i]["genreAlt"]}, 개봉년도 : ${list[i]["prdtYear"]}, 개봉나라 : ${list[i]["nationAlt"]}`
                                tagfield.prepend(p)
                                p.onclick = onClickModalClose
                            }
                        }
    
                    }
                })
            }else {
                alert("영화를 검색해주세요")
            }
        }
        function onClickModalClose() {
            console.log("체크되었습니다")
            checkMovieNm=true
            document.getElementById("modal").style.display="none"
            
        }
        function onclickCloseModal(){
            console.log("aaa")
            document.getElementById("modal").style.display="none"
        }
    </script>
</html>